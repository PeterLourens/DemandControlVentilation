<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="The front-end for configuration of the open source demand controlled ventilation system">
    <title>Open Source demand driven ventilation system &ndash; Configuration and Monitoring</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="pure_min.css">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="layout">
        <!-- Menu toggle -->
        <a href="#menu" id="menuLink" class="menu-link">
            <!-- Hamburger icon -->
            <span></span>
        </a>
        <div id="menu">
            <div class="pure-menu">
                <div class="pure-menu-heading">OSVentilation</div>
                <ul class="pure-menu-list">
                    <li class="pure-menu-item"><a href="/" class="pure-menu-link">Status</a></li>
                    <li class="pure-menu-item"><a href="/settings" class="pure-menu-link">Settings</a></li>
                    <li class="pure-menu-item"><a href="/valvecontrol" class="pure-menu-link">Valve Control</a></li>
                    <li class="pure-menu-item"><a href="/sensorconfig" class="pure-menu-link">Sensors</a></li>
                    <li class="pure-menu-item"><a href="/statemachine" class="pure-menu-link">Statemachine</a></li>
                    <li class="pure-menu-item"><a href="/web_serial" class="pure-menu-link">Webserial</a></li>
                </ul>
            </div>
        </div>

        <div id="main">
            <div class="header">
                <h2>Settings</h2>
            </div>
            <div class="content">
                <form method="POST" action="/restart_esp32">
                    <input type="submit" value="Restart ESP32" class="pure-button-primary button-xsmall pure-button">
                </form>

                <h4 class="content-subhead">Network configuration (requires ESP32 restart)</h4>

                <form class="pure-form pure-form-stacked" method="POST" action="/settings_network">
                    <fieldset>
                        <div class="pure-g">
                            <div class="pure-u-1 pure-u-md-1-1">
                                <label for="enable_dhcp">Enable DHCP:</label>
                                <select name="enable_dhcp" id="enable_dhcp" class="pure-input-1-1">
                                    <option>On</option>
                                    <option>Off</option>
                                </select>
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="ssid">SSID:</label>
                                <input type="text" id="ssid" name="ssid" class="pure-input-3-4">
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="wifi_password">WIFI Password:</label>
                                <input type="text" id="wifi_password" name="wifi_password" class="pure-input-3-4">
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="ip_address">IP Address:</label>
                                <input type="text" placeholder="Leave blank for DHCP" name="ip_address" id="ip_address"
                                    class="pure-input-3-4">
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="subnet_mask">Subnet mask:</label>
                                <input type="text" placeholder="Leave blank for DHCP" name="subnet_mask"
                                    id="subnet_mask" class="pure-input-3-4">
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="gateway">Gateway:</label>
                                <input type="text" placeholder="Leave blank for DHCP" name="gateway" id="gateway"
                                    class="pure-input-3-4">
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="primary_dns">Primary DNS server:</label>
                                <input type="text" placeholder="Leave blank for DHCP" name="primary_dns"
                                    id="primary_dns" class="pure-input-3-4">
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="secondary_dns">Secundary DNS server (optional):</label>
                                <input type="text" placeholder="Leave blank for DHCP" name="secondary_dns"
                                    id="secondary_dns" class="pure-input-3-4">
                            </div>
                        </div>
                        <br>
                        <input type="submit" value="Save network configuration"
                            class="pure-button-primary button-xsmall pure-button">
                        <br>
                    </fieldset>
                </form>

                <h4 class="content-subhead">MQTT configuration</h4>

                <form class="pure-form pure-form-stacked" method="POST" action="/settings_mqtt">
                    <fieldset>
                        <div class="pure-g">
                            <div class="pure-u-1 pure-u-md-1-1">
                                <label for="enable_mqtt">Enable MQTT:</label>
                                <select name="enable_mqtt" id="enable_mqtt" class="pure-input-1-1">
                                    <option>On</option>
                                    <option>Off</option>
                                </select>
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="mqtt_server">MQTT Server:</label>
                                <input type="text" placeholder="MQTT Server ipdress or hostname" name="mqtt_server"
                                    id="mqtt_server" class="pure-input-3-4">
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="mqtt_port">MQTT Server port:</label>
                                <input type="text" placeholder="default is 1883" name="mqtt_port" id="mqtt_port"
                                    class="pure-input-3-4">
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="mqtt_base_topic">MQTT Base topic:</label>
                                <input type="text" placeholder="Fill in base topic" name="mqtt_base_topic"
                                    id="mqtt_base_topic" class="pure-input-3-4">
                            </div>
                        </div>
                        <br>
                        <input type="submit" value="Save MQTT settings"
                            class="pure-button-primary button-xsmall pure-button">
                        <br>
                    </fieldset>
                </form>

                <h4 class="content-subhead">Hardware I2C configuration (requires ESP32 restart)</h4>

                <form class="pure-form pure-form-stacked" method="POST" action="/settings_i2c">
                    <fieldset>
                        <div class="pure-g">
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="bus0_multiplexer_address">Bus0 (Wire) I2C Multiplexer address (in
                                    dec):</label>
                                <input type="text" placeholder="default 0x70" name="bus0_multiplexer_address"
                                    id="bus0_multiplexer_address" class="pure-input-3-4">
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="bus1_multiplexer_address">Bus1 (Wire1) I2C Multiplexer address (in
                                    dec):</label>
                                <input type="text" placeholder="default 0x70" name="bus1_multiplexer_address"
                                    id="bus1_multiplexer_address" class="pure-input-3-4">
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="enable_lcd">Enable display:</label>
                                <select id="enable_lcd" name="enable_lcd" class="pure-input-1-1">
                                    <option>On</option>
                                    <option>Off</option>
                                </select>
                            </div>
                        </div>
                        <br>
                        <input type="submit" value="Save I2C settings"
                            class="pure-button-primary button-xsmall pure-button">
                        <br>
                    </fieldset>
                </form>

                <h4 class="content-subhead">Fan control settings, by MQTT subscribe or http request</h4>

                <form class="pure-form pure-form-stacked" method="POST" action="/settings_fan">
                    <fieldset>
                        <div class="pure-g">
                            <div class="pure-u-1 pure-u-md-1-1">
                                <label for="fan_control_mode">Fan control mode:</label>
                                <select id="fan_control_mode" name="fan_control_mode" class="pure-input-1-4">
                                    <option>MQTT subscribe</option>
                                    <option>HTTP API</option>
                                </select>
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="fan_control_mqtt_server">Fan control MQTT Server:</label>
                                <input type="text" placeholder="Fan control MQTT server ipdress or hostname"
                                    name="fan_control_mqtt_server" id="fan_control_mqtt_server" class="pure-input-3-4">
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="fan_control_mqtt_port">Fan control MQTT Server port:</label>
                                <input type="text" placeholder="default is 1883" name="fan_control_mqtt_port"
                                    id="fan_control_mqtt_port" class="pure-input-3-4">
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="fan_control_mqtt_topic">Fan control MQTT publish topic:</label>
                                <input type="text" placeholder="MQTT topic" name="fan_control_mqtt_topic"
                                    id="fan_control_mqtt_topic" class="pure-input-3-4">
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="fan_control_url_high_speed">Fan control URL high speed:</label>
                                <input type="text" placeholder="URL" name="fan_control_url_high_speed"
                                    id="fan_control_url_high_speed" class="pure-input-3-4">
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="fan_control_url_medium_speed">Fan control URL medium speed:</label>
                                <input type="text" placeholder="URL" name="fan_control_url_medium_speed"
                                    id="fan_control_url_medium_speed" class="pure-input-3-4">
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="fan_control_url_low_speed">Fan control URL low speed:</label>
                                <input type="text" placeholder="URL" name="fan_control_url_low_speed"
                                    id="fan_control_url_low_speed" class="pure-input-3-4">
                            </div>
                        </div>
                        <br>
                        <input type="submit" value="Save fan control settings"
                            class="pure-button-primary button-xsmall pure-button">
                        <br>
                    </fieldset>
                </form>

                <h4 class="content-subhead">InfluxDB configuration</h4>

                <form class="pure-form pure-form-stacked" method="POST" action="/settings_influxdb">
                    <fieldset>
                        <div class="pure-g">
                            <div class="pure-u-1 pure-u-md-1-1">
                                <label for="enable_influxdb">Enable InfluxDB:</label>
                                <select id="enable_influxdb" name="enable_influxdb" class="pure-input-1-1">
                                    <option>On</option>
                                    <option>Off</option>
                                </select>
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="influxdb_url">InfluxDB URL:</label>
                                <input type="text" placeholder="http://ip-address:8086" name="influxdb_url"
                                    id="influxdb_url" class="pure-input-3-4">
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="influxdb_org">InfluxDB org:</label>
                                <input type="text" placeholder="Fill in InfluxDB organisation" name="influxdb_org"
                                    id="influxdb_org" class="pure-input-3-4">
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="influxdb_bucket">InfluxDB bucket:</label>
                                <input type="text" placeholder="Fill in InfluxDB bucket name" name="influxdb_bucket"
                                    id="influxdb_bucket" class="pure-input-3-4">
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="influxdb_token">InfluxDB token:</label>
                                <input type="text" placeholder="Fill in InfluxDB token" name="influxdb_token"
                                    id="influxdb_token" class="pure-input-3-4">
                            </div>
                        </div>
                        <br>
                        <input type="submit" value="Save InfluxDB settings"
                            class="pure-button-primary button-xsmall pure-button">
                        <br>
                    </fieldset>
                </form>

                <h4 class="content-subhead">Time configuration (requires ESP32 restart)</h4>

                <form class="pure-form pure-form-stacked" method="POST" action="/settings_rtc">
                    <fieldset>
                        <div class="pure-g">
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="timezone">Timezone:</label>
                                <input type="text" placeholder="CET-1CEST,M3.5.0,M10.5.0/3" name="timezone"
                                    id="timezone" class="pure-input-3-4">
                            </div>
                            <div class="pure-u-1 pure-u-md-1-2">
                                <label for="ntp_server">NTP server address:</label>
                                <input type="text" placeholder="e.g. pool.ntp.org" name="ntp_server" id="ntp_server"
                                    class="pure-input-3-4">
                            </div>

                        </div>
                        <br>
                        <input type="submit" value="Save RTC settings"
                            class="pure-button-primary button-xsmall pure-button">
                        <br>
                    </fieldset>
                </form>
                <p>
                    Refer to <a href="https://www.gnu.org/software/libc/manual/html_node/TZ-Variable.html"
                        target="_blank">GNU documentation on TZ-Variable</a> for more details on format.<br>
                    For Europe/Amsterdam use: CET-1CEST,M3.5.0,M10.5.0/3
                </p>
            </div>
        </div>
        <div id="page_name">settings</div>
    </div>
    <script src="ui.js"></script>
    <script src="websocket.js"></script>
</body>

</html>